<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Key findings and achievements:</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="performance_files/libs/clipboard/clipboard.min.js"></script>
<script src="performance_files/libs/quarto-html/quarto.js"></script>
<script src="performance_files/libs/quarto-html/popper.min.js"></script>
<script src="performance_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="performance_files/libs/quarto-html/anchor.min.js"></script>
<link href="performance_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="performance_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="performance_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="performance_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="performance_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Key findings and achievements:</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><font size="6">MotoGP Race Data</font><br><br> <font size="6"><b>üèçÔ∏è Modelling Riders Performance</b></font><br><br></p>
<p><font size="4">Antonio Buzzelli</font><br> <font size="4">May 2023</font></p>
<p>Sports are being radically transformed by data collection and analysis, benefiting both professionals and fans. Soccer, baseball, and American football are some examples where player performance data is utilized to acquire talent and provide in-depth statistics for the public. In contrast, data analysis for motorsports fans is not yet widespread, despite being fundamental to the sport‚Äôs operation.</p>
<p>In this notebook, we will explore the realm of MotoGP racing and analyze publicly available race data with the aim of comprehending how it can be used to provide fans with essential <strong>insights on riders‚Äô performance</strong>. By employing statistical methodologies, we will extract as much insights as possible from the openly accessible data, contending that it is possible to gauge the riders‚Äô objective performances within a race and across the championship. At the same time, we will propose potential data analyses ‚Äì presented as a ‚Äúpost-GP‚Äù information product ‚Äì that can be used by the media to interpret Grand Prix outcomes and which can spark engaging discussions on the competitors‚Äô performance levels and progress.</p>
<blockquote class="blockquote">
<p><em>Data is provided thanks to the <a href="https://github.com/antobzzll/motogpdata">motogpdata</a> project.</em></p>
</blockquote>
<ul>
<li>For the purpose of providing more technical and structured insights to fans, we demonstrate how public race data can be used to extract important information on race and rider performance.</li>
<li>We demonstrate how to <strong>quantify the performances</strong> of riders, teams, and constructors through <strong>quantitative indicators</strong> that take into account <strong>relative speed and consistency</strong>, the two fundamental variables in the theoretical definition of ‚Äúperformance.‚Äù ___</li>
</ul>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> motogpdata.handler <span class="im">as</span> mgphandler</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>template <span class="op">=</span> <span class="st">"plotly_white"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="race-results" class="level1">
<h1>Race Results</h1>
<p>For the scope of this study, we will take into account and examine two races from the 2022 MotoGP season, namely the Qatar Grand Prix and the Italian Grand Prix. Let‚Äôs first refresh our memory of the results of these races.</p>
<p>For the Qatar Grand Prix:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>season <span class="op">=</span> mgphandler.Season(<span class="dv">2022</span>, <span class="st">'MotoGP'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>qat2022 <span class="op">=</span> mgphandler.Event(season, <span class="st">'QAT'</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ita2022 <span class="op">=</span> mgphandler.Event(season, <span class="st">'ITA'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>results_subset <span class="op">=</span> [<span class="st">'rider.full_name'</span>, <span class="st">'position'</span>, <span class="st">'average_speed'</span>, <span class="st">'total_laps'</span>, <span class="st">'time'</span>, <span class="st">'points'</span>]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>qat2022.results()[results_subset].set_index(<span class="st">'rider.full_name'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">position</th>
<th data-quarto-table-cell-role="th">average_speed</th>
<th data-quarto-table-cell-role="th">total_laps</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">points</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">rider.full_name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Enea Bastianini</td>
<td>1.0</td>
<td>168.2</td>
<td>22</td>
<td>42:13.1980</td>
<td>25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Brad Binder</td>
<td>2.0</td>
<td>168.1</td>
<td>22</td>
<td>42:13.5440</td>
<td>20</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Pol Espargaro</td>
<td>3.0</td>
<td>168.1</td>
<td>22</td>
<td>42:14.5490</td>
<td>16</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Aleix Espargaro</td>
<td>4.0</td>
<td>168.0</td>
<td>22</td>
<td>42:15.4400</td>
<td>13</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Marc Marquez</td>
<td>5.0</td>
<td>167.9</td>
<td>22</td>
<td>42:17.2970</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Joan Mir</td>
<td>6.0</td>
<td>167.8</td>
<td>22</td>
<td>42:18.0410</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Alex Rins</td>
<td>7.0</td>
<td>167.6</td>
<td>22</td>
<td>42:22.0080</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Johann Zarco</td>
<td>8.0</td>
<td>167.5</td>
<td>22</td>
<td>42:23.7340</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Fabio Quartararo</td>
<td>9.0</td>
<td>167.5</td>
<td>22</td>
<td>42:23.7410</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Takaaki Nakagami</td>
<td>10.0</td>
<td>167.2</td>
<td>22</td>
<td>42:28.1650</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Franco Morbidelli</td>
<td>11.0</td>
<td>167.1</td>
<td>22</td>
<td>42:29.9100</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Maverick Vi√±ales</td>
<td>12.0</td>
<td>166.6</td>
<td>22</td>
<td>42:36.4140</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Luca Marini</td>
<td>13.0</td>
<td>166.4</td>
<td>22</td>
<td>42:40.4810</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Andrea Dovizioso</td>
<td>14.0</td>
<td>166.4</td>
<td>22</td>
<td>42:40.5720</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Remy Gardner</td>
<td>15.0</td>
<td>165.5</td>
<td>22</td>
<td>42:54.3050</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Darryn Binder</td>
<td>16.0</td>
<td>165.5</td>
<td>22</td>
<td>42:54.3170</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Fabio Di Giannantonio</td>
<td>17.0</td>
<td>165.5</td>
<td>22</td>
<td>42:54.5470</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Raul Fernandez</td>
<td>18.0</td>
<td>165.4</td>
<td>22</td>
<td>42:55.5550</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Francesco Bagnaia</td>
<td>NaN</td>
<td>167.2</td>
<td>11</td>
<td>21:13.8350</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Jorge Martin</td>
<td>NaN</td>
<td>167.2</td>
<td>11</td>
<td>21:13.8000</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Miguel Oliveira</td>
<td>NaN</td>
<td>166.9</td>
<td>10</td>
<td>19:19.8860</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Alex Marquez</td>
<td>NaN</td>
<td>166.6</td>
<td>9</td>
<td>17:25.7820</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Jack Miller</td>
<td>NaN</td>
<td>165.4</td>
<td>6</td>
<td>11:42.3060</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Marco Bezzecchi</td>
<td>NaN</td>
<td>165.6</td>
<td>6</td>
<td>11:41.3210</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>For the Italian Grand Prix:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ita2022.results()[results_subset].set_index(<span class="st">'rider.full_name'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">position</th>
<th data-quarto-table-cell-role="th">average_speed</th>
<th data-quarto-table-cell-role="th">total_laps</th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">points</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">rider.full_name</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Francesco Bagnaia</td>
<td>1.0</td>
<td>175.1</td>
<td>23</td>
<td>41:18.9230</td>
<td>25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Fabio Quartararo</td>
<td>2.0</td>
<td>175.1</td>
<td>23</td>
<td>41:19.5580</td>
<td>20</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aleix Espargaro</td>
<td>3.0</td>
<td>175.0</td>
<td>23</td>
<td>41:20.9060</td>
<td>16</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Johann Zarco</td>
<td>4.0</td>
<td>175.0</td>
<td>23</td>
<td>41:21.5130</td>
<td>13</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Marco Bezzecchi</td>
<td>5.0</td>
<td>174.9</td>
<td>23</td>
<td>41:21.9900</td>
<td>11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Luca Marini</td>
<td>6.0</td>
<td>174.9</td>
<td>23</td>
<td>41:22.7980</td>
<td>10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Brad Binder</td>
<td>7.0</td>
<td>174.9</td>
<td>23</td>
<td>41:22.9900</td>
<td>9</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Takaaki Nakagami</td>
<td>8.0</td>
<td>174.4</td>
<td>23</td>
<td>41:29.8670</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Miguel Oliveira</td>
<td>9.0</td>
<td>174.3</td>
<td>23</td>
<td>41:30.1790</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Marc Marquez</td>
<td>10.0</td>
<td>174.3</td>
<td>23</td>
<td>41:30.7230</td>
<td>6</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Fabio Di Giannantonio</td>
<td>11.0</td>
<td>174.2</td>
<td>23</td>
<td>41:31.8390</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Maverick Vi√±ales</td>
<td>12.0</td>
<td>174.2</td>
<td>23</td>
<td>41:31.8400</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Jorge Martin</td>
<td>13.0</td>
<td>173.9</td>
<td>23</td>
<td>41:36.1630</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Alex Marquez</td>
<td>14.0</td>
<td>173.9</td>
<td>23</td>
<td>41:36.4910</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Jack Miller</td>
<td>15.0</td>
<td>173.9</td>
<td>23</td>
<td>41:36.6100</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Darryn Binder</td>
<td>16.0</td>
<td>173.7</td>
<td>23</td>
<td>41:39.1880</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Franco Morbidelli</td>
<td>17.0</td>
<td>173.7</td>
<td>23</td>
<td>41:39.2190</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Michele Pirro</td>
<td>18.0</td>
<td>173.6</td>
<td>23</td>
<td>41:40.2280</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Remy Gardner</td>
<td>19.0</td>
<td>173.0</td>
<td>23</td>
<td>41:49.4710</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Andrea Dovizioso</td>
<td>20.0</td>
<td>173.0</td>
<td>23</td>
<td>41:49.9340</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Raul Fernandez</td>
<td>21.0</td>
<td>172.2</td>
<td>23</td>
<td>42:01.6460</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Lorenzo Savadori</td>
<td>22.0</td>
<td>164.9</td>
<td>22</td>
<td>41:58.6110</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Enea Bastianini</td>
<td>NaN</td>
<td>174.8</td>
<td>13</td>
<td>23:24.0940</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Joan Mir</td>
<td>NaN</td>
<td>172.8</td>
<td>7</td>
<td>12:44.7980</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Alex Rins</td>
<td>NaN</td>
<td>173.5</td>
<td>7</td>
<td>12:41.6070</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Pol Espargaro</td>
<td>NaN</td>
<td>171.2</td>
<td>4</td>
<td>07:21.0900</td>
<td>0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The traditional race classification tables (which represent the only type of data considered by most of the media when reporting on races) do not provide many analytical insights nor objective indicators of riders performances. They merely offer a snapshot of the race outcome; and the final result does not provide a comprehensive evaluation of the competitors‚Äô achievements in the race.</p>
<p>It is in fact possible for a rider to finish a race in a certain position thanks to the mistakes of others, even if he has maintained an anonymous performance throughout the race. In such situations, the most common question that arises is whether or not the rider ‚Äúdeserved‚Äù or not the position he achieved at the end of the race. In other words, we ask: what was the rider‚Äôs performance after accounting for the race events? How can we measure and evaluate he‚Äôs performance regardless of the result obtained?</p>
</section>
<section id="laptime-analysis" class="level1">
<h1>Laptime analysis</h1>
<p>A statistical assessment of race performance is required to address these inquiries, which entails an evaluation based on factual data rather than subjective sentiments or judgments. To accomplish this, the data on lap times must be taken into account, scrutinizing the race‚Äôs overall progress. An illustration of such data for the Qatar race is presented below.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract race analysis data for the Qatar Grand Prix</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>timesheetQAT, laptimes_ridersQAT, laptimes_teamsQAT, laptimes_constructorsQAT, performanceQAT <span class="op">=</span> qat2022.race_analysis(save_pdf<span class="op">=</span><span class="va">False</span>, performance<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>laptimes_ridersQAT.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">rider</th>
<th data-quarto-table-cell-role="th">Aleix Espargaro</th>
<th data-quarto-table-cell-role="th">Alex Marquez</th>
<th data-quarto-table-cell-role="th">Alex Rins</th>
<th data-quarto-table-cell-role="th">Andrea Dovizioso</th>
<th data-quarto-table-cell-role="th">Brad Binder</th>
<th data-quarto-table-cell-role="th">Darryn Binder</th>
<th data-quarto-table-cell-role="th">Enea Bastianini</th>
<th data-quarto-table-cell-role="th">Fabio Di Giannantonio</th>
<th data-quarto-table-cell-role="th">Fabio Quartararo</th>
<th data-quarto-table-cell-role="th">Francesco Bagnaia</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Marc Marquez</th>
<th data-quarto-table-cell-role="th">Marco Bezzecchi</th>
<th data-quarto-table-cell-role="th">Maverick Vi√±ales</th>
<th data-quarto-table-cell-role="th">Miguel Oliveira</th>
<th data-quarto-table-cell-role="th">Pol Espargaro</th>
<th data-quarto-table-cell-role="th">Raul Fernandez</th>
<th data-quarto-table-cell-role="th">Remy Gardner</th>
<th data-quarto-table-cell-role="th">Takaaki Nakagami</th>
<th data-quarto-table-cell-role="th">avg_laptime</th>
<th data-quarto-table-cell-role="th">lap</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">lap</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>121.559</td>
<td>122.479</td>
<td>122.363</td>
<td>123.815</td>
<td>121.021</td>
<td>124.531</td>
<td>121.438</td>
<td>125.299</td>
<td>122.042</td>
<td>121.817</td>
<td>...</td>
<td>120.713</td>
<td>122.419</td>
<td>124.207</td>
<td>122.558</td>
<td>120.669</td>
<td>125.229</td>
<td>125.051</td>
<td>122.755</td>
<td>122.863542</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>115.237</td>
<td>116.054</td>
<td>115.487</td>
<td>116.887</td>
<td>115.086</td>
<td>116.721</td>
<td>114.953</td>
<td>116.269</td>
<td>115.415</td>
<td>115.135</td>
<td>...</td>
<td>115.265</td>
<td>116.229</td>
<td>116.618</td>
<td>116.259</td>
<td>115.181</td>
<td>116.272</td>
<td>116.173</td>
<td>115.975</td>
<td>115.839625</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>114.797</td>
<td>115.223</td>
<td>114.610</td>
<td>115.858</td>
<td>114.846</td>
<td>115.720</td>
<td>114.918</td>
<td>115.982</td>
<td>115.007</td>
<td>114.771</td>
<td>...</td>
<td>114.875</td>
<td>115.636</td>
<td>116.134</td>
<td>115.488</td>
<td>114.797</td>
<td>116.531</td>
<td>115.974</td>
<td>115.909</td>
<td>115.377417</td>
<td>3</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>115.000</td>
<td>115.329</td>
<td>114.706</td>
<td>115.860</td>
<td>115.069</td>
<td>115.591</td>
<td>114.991</td>
<td>116.212</td>
<td>115.171</td>
<td>115.223</td>
<td>...</td>
<td>115.032</td>
<td>116.318</td>
<td>116.044</td>
<td>115.057</td>
<td>115.076</td>
<td>116.106</td>
<td>116.167</td>
<td>116.029</td>
<td>115.478208</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>114.944</td>
<td>115.328</td>
<td>115.013</td>
<td>117.290</td>
<td>114.867</td>
<td>116.474</td>
<td>114.956</td>
<td>116.228</td>
<td>115.236</td>
<td>115.105</td>
<td>...</td>
<td>114.867</td>
<td>115.520</td>
<td>116.015</td>
<td>115.097</td>
<td>114.753</td>
<td>116.326</td>
<td>116.210</td>
<td>115.380</td>
<td>115.526708</td>
<td>5</td>
</tr>
</tbody>
</table>

<p>5 rows √ó 26 columns</p>
</div>
</div>
</div>
<p>The above table (in its comprehensive form) shows the lap times of each rider (expressed in seconds), and provides already a good starting point for deepening the understanding of the time trends and the general race progression. From such data, it is possible to generate some of the following visualizations.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.line(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    laptimes_ridersQAT, x<span class="op">=</span><span class="st">'lap'</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>[<span class="st">'avg_laptime'</span>, <span class="st">'Enea Bastianini'</span>, <span class="st">'Aleix Espargaro'</span>, <span class="st">'Raul Fernandez'</span>],</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">'value'</span>:<span class="st">'Lap times (in seconds)'</span>, <span class="st">'lap'</span>:<span class="st">'Laps'</span>},</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    color_discrete_sequence<span class="op">=</span>[<span class="st">'grey'</span>, <span class="st">'red'</span>, <span class="st">'green'</span>, <span class="st">'darkorange'</span>],</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"&lt;b&gt;üá∂üá¶ Qatar 2022&lt;/b&gt;&lt;br&gt;Comparative Lap Time Analysis - Riders"</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>fig.update_layout(legend<span class="op">=</span><span class="bu">dict</span>(y<span class="op">=</span><span class="fl">0.99</span>, x<span class="op">=</span><span class="fl">0.01</span>, orientation<span class="op">=</span><span class="st">'h'</span>))</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>fig.update_layout(legend_title_text<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>fig.update_traces(selector<span class="op">=</span><span class="bu">dict</span>(name<span class="op">=</span><span class="st">'avg_laptime'</span>), name<span class="op">=</span><span class="st">'Average'</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>fig.update_layout(template<span class="op">=</span>template)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>By projecting the <em>average lap time</em> (gray line), we can appreciate the general trend of the race. For example, in the case of Qatar, there is a decline in overall performance starting from the seventeenth lap. Similarly, there is a significant performance drop in the Italian Grand Prix race starting from the sixteenth lap. <strong>This analysis helps to evaluate tire performance</strong>.</p>
<p>Regarding the personal lap times of the riders, we can notice that both Enea Bastianini (who arrived in 1st place) and Aleix Espargaro (who arrived in 4th place) performed well below the average (gray line), unlike Raul Fernandez, for example (orange line), who consistently raced above the general average of the competition. Similar considerations can also be applied to the Italian Grand Prix, as shown below.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>timesheetITA, laptimes_ridersITA, laptimes_teamsITA, laptimes_constructorsITA, performanceITA <span class="op">=</span> ita2022.race_analysis(save_pdf<span class="op">=</span><span class="va">False</span>, performance<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.line(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    laptimes_ridersITA, x<span class="op">=</span><span class="st">'lap'</span>, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>[<span class="st">'avg_laptime'</span>, <span class="st">'Francesco Bagnaia'</span>, <span class="st">'Fabio Quartararo'</span>, <span class="st">'Andrea Dovizioso'</span>],</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">'value'</span>:<span class="st">'Lap times (in seconds)'</span>, <span class="st">'lap'</span>:<span class="st">'Laps'</span>},</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    color_discrete_sequence<span class="op">=</span>[<span class="st">'grey'</span>, <span class="st">'red'</span>, <span class="st">'blue'</span>, <span class="st">'aqua'</span>],</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"&lt;b&gt;üáÆüáπ Mugello 2022&lt;/b&gt;&lt;br&gt;Comparative Lap Time Analysis - Riders"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>fig.update_layout(legend<span class="op">=</span><span class="bu">dict</span>(y<span class="op">=</span><span class="fl">0.99</span>, x<span class="op">=</span><span class="fl">0.01</span>, orientation<span class="op">=</span><span class="st">'h'</span>))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>fig.update_layout(legend_title_text<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>fig.update_traces(selector<span class="op">=</span><span class="bu">dict</span>(name<span class="op">=</span><span class="st">'avg_laptime'</span>), name<span class="op">=</span><span class="st">'Media'</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>fig.update_layout(template<span class="op">=</span>template)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>These graphs provide a visual and intuitive way to determine if a particular rider, team, or manufacturer has performed above, below, or at an average level. (It‚Äôs important to note that the more a rider‚Äôs lap times are below the average race‚Äôs lap time, the faster they‚Äôve gone). Using the same visualization concept for the concstructors, we can see how Yamaha and KTM consistently performed above average in the Qatar 2022 race, thus indicating that they ‚Äúunderperformed‚Äù compared to the other manufacturers.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.line(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    laptimes_constructorsQAT, x<span class="op">=</span><span class="st">'lap'</span>, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span>[<span class="st">'avg_laptime'</span>, <span class="st">'Yamaha'</span>, <span class="st">'KTM'</span>],</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">'value'</span>:<span class="st">'Lap Times (in seconds)'</span>, <span class="st">'lap'</span>:<span class="st">'Laps'</span>},</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    color_discrete_sequence<span class="op">=</span>[<span class="st">'grey'</span>, <span class="st">'blue'</span>, <span class="st">'darkorange'</span>],</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"&lt;b&gt;üá∂üá¶ Qatar 2022&lt;/b&gt;&lt;br&gt;Comparative Lap Time Analysis - Constructors"</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>fig.update_layout(legend<span class="op">=</span><span class="bu">dict</span>(y<span class="op">=</span><span class="fl">0.99</span>, x<span class="op">=</span><span class="fl">0.01</span>, orientation<span class="op">=</span><span class="st">'h'</span>))</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>fig.update_layout(legend_title_text<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>fig.update_traces(selector<span class="op">=</span><span class="bu">dict</span>(name<span class="op">=</span><span class="st">'avg_laptime'</span>), name<span class="op">=</span><span class="st">'Media'</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>fig.update_layout(template<span class="op">=</span>template)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<section id="sector-times" class="level2">
<h2 class="anchored" data-anchor-id="sector-times">Sector times</h2>
<p>In an aggregate manner, it is also possible to determine variation indicators for each sector of the circuit, thereby appreciating the overall level of consistency of the riders in the various sections of the track. For example, we can observe that in the case of the Qatar Grand Prix, the consistency of lap times in different sectors is almost identical, while at Mugello, the sector in which the drivers were on average more consistent is T2.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>std_race <span class="op">=</span> pd.DataFrame(timesheetQAT[timesheetQAT[<span class="st">'lap'</span>] <span class="op">!=</span> <span class="dv">1</span>][[<span class="st">'t1'</span>, <span class="st">'t2'</span>, <span class="st">'t3'</span>, <span class="st">'t4'</span>]].std())</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>std_race <span class="op">=</span> std_race.pivot_table(columns<span class="op">=</span>std_race.index).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>std_race.index <span class="op">=</span> [<span class="st">'œÉ'</span>]</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"üá∂üá¶ Qatar Grand Prix 2022</span><span class="ch">\n</span><span class="st">Sector Pace:"</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>std_race</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>üá∂üá¶ Qatar Grand Prix 2022
Sector Pace:</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">t1</th>
<th data-quarto-table-cell-role="th">t2</th>
<th data-quarto-table-cell-role="th">t3</th>
<th data-quarto-table-cell-role="th">t4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">œÉ</td>
<td>0.21</td>
<td>0.23</td>
<td>0.21</td>
<td>0.21</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>std_race <span class="op">=</span> pd.DataFrame(timesheetITA[timesheetITA[<span class="st">'lap'</span>] <span class="op">!=</span> <span class="dv">1</span>][[<span class="st">'t1'</span>, <span class="st">'t2'</span>, <span class="st">'t3'</span>, <span class="st">'t4'</span>]].std())</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>std_race <span class="op">=</span> std_race.pivot_table(columns<span class="op">=</span>std_race.index).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>std_race.index <span class="op">=</span> [<span class="st">'œÉ'</span>]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"üáÆüáπ Italian Grand Prix 2022</span><span class="ch">\n</span><span class="st">Sector pace:"</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>std_race</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>üáÆüáπ Italian Grand Prix 2022
Sector pace:</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">t1</th>
<th data-quarto-table-cell-role="th">t2</th>
<th data-quarto-table-cell-role="th">t3</th>
<th data-quarto-table-cell-role="th">t4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">œÉ</td>
<td>0.46</td>
<td>0.24</td>
<td>0.74</td>
<td>0.45</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The same principle of analysis can be applied to the fastest times set by riders in the different sectors of the track. At the Mugello Grand Prix, we can see, for example, how Yamaha, with Fabio Quartararo, was the fastest in T2 and T3. In contrast, the Ducatis of Bagnaia and Bastianini expressed the best times in the sectors with higher top speeds (T1 and T4).</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>by_rider <span class="op">=</span> timesheetITA[timesheetITA[<span class="st">'lap'</span>] <span class="op">!=</span> <span class="dv">1</span>].groupby([<span class="st">'constructor'</span>, <span class="st">'rider'</span>])[[<span class="st">'t1'</span>, <span class="st">'t2'</span>, <span class="st">'t3'</span>, <span class="st">'t4'</span>]].<span class="bu">min</span>().<span class="bu">round</span>(<span class="dv">3</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>rider_with_min <span class="op">=</span> by_rider.idxmin()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>const_t <span class="op">=</span> pd.DataFrame({</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'rider'</span>: rider_with_min, </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'fastest_time'</span>: by_rider.<span class="bu">min</span>()})</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>const_t[[<span class="st">'constructor'</span>, <span class="st">'rider'</span>]] <span class="op">=</span> pd.DataFrame(const_t[<span class="st">'rider'</span>].tolist(), index<span class="op">=</span>const_t.index)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"üáÆüáπ Italian Grand Prix 2022</span><span class="ch">\n</span><span class="st">Fastest sector times:</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(const_t[[<span class="st">'constructor'</span>, <span class="st">'rider'</span>, <span class="st">'fastest_time'</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>üáÆüáπ Italian Grand Prix 2022
Fastest sector times:

   constructor              rider  fastest_time
t1      Ducati  Francesco Bagnaia        24.868
t2      Yamaha   Fabio Quartararo        22.499
t3      Yamaha   Fabio Quartararo        34.842
t4      Ducati    Enea Bastianini        23.998</code></pre>
</div>
</div>
<p>In general, analyzing sector times under different measures of aggregation (average time, minimum, maximum, consistency in terms of standard deviation, etc.) can reveal interesting points of comparison to evaluate the adaptation to the track of riders, teams, and constructors.</p>
</section>
</section>
<section id="performance-analysis" class="level1">
<h1>Performance analysis</h1>
<p>Although an analysis of times like this already gives a clear idea of the general trend of the race, it alone cannot provide an answer to our initial question. In fact, to quantify riders‚Äô performances, it is necessary to deepen the analysis and develop quantitative indicators.</p>
<section id="the-performance-matrix" class="level2">
<h2 class="anchored" data-anchor-id="the-performance-matrix">The Performance Matrix</h2>
<p>Motorsports performance, can be defined as ‚Äú<em>how consistently fast a rider has been</em>‚Äù - relative to the number of laps completed. Therefore, at a conceptual level, the so-called ‚Äúpace‚Äù can be theorized as the aggregation of two fundamental variables: consistency and speed. To achieve high positions in the rankings, a rider must in fact be both fast and consistent.</p>
<p>Visually, the relationship between these two variables can be demonstrated with the help of a matrix - shown below - which we will call the ‚Äúperformance matrix‚Äù. The graph represents the ratio between the two indicators (<em>relative speed</em> on the y-axis and <em>relative consistency</em> on the x-axis) for each participant in the race, in relation to their average located at the axes <span class="math inline">\(x,y=0\)</span> (black lines). This means that the performance of the riders located in the upper-right quadrant of the graph are above average, both in terms of speed and consistency. Conversely, those located in the lower-left quadrant have ‚Äúunderperformed‚Äù below average (for both variables).</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>perf_cols <span class="op">=</span> [<span class="st">'rider'</span>, <span class="st">'constructor'</span>, <span class="st">'grid'</span>, <span class="st">'position'</span>, <span class="st">'pos_delta'</span>, <span class="st">'points'</span>, <span class="st">'avg_laptime'</span>, <span class="st">'avg_speed'</span>, <span class="st">'delta_avg_laptime'</span>, <span class="st">'pace_speed_index'</span>, <span class="st">'delta_std_laptime'</span>, <span class="st">'pace_consistency_index'</span>, <span class="st">'performance_index'</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>performanceQAT <span class="op">=</span> performanceQAT[perf_cols].set_index(<span class="st">'rider'</span>).<span class="bu">round</span>(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    performanceQAT, </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'pace_consistency_index'</span>, </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'pace_speed_index'</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'constructor'</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    color_discrete_sequence<span class="op">=</span>[<span class="st">'red'</span>, <span class="st">'darkorange'</span>, <span class="st">'orange'</span>, <span class="st">'green'</span>, <span class="st">'aqua'</span>, <span class="st">'blue'</span>],</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span>performanceQAT[<span class="st">'points'</span>].astype(<span class="bu">str</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">''</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">'0'</span> <span class="cf">else</span> x),</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># text='position',</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">'pace_speed_index'</span>: <span class="st">'Relative Speed Indicator (in seconds)'</span>, <span class="st">'pace_consistency_index'</span>: <span class="st">'Relative Consistency Indicator (in seconds)'</span>},</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"&lt;b&gt;üá∂üá¶ Qatar 2022&lt;/b&gt;&lt;br&gt;Performance Matrix - Riders"</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># trendline='ols'</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>fig.update_traces(</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    textposition<span class="op">=</span><span class="st">'top center'</span>,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">8</span>))</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>fig.add_shape(</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">type</span><span class="op">=</span><span class="st">'line'</span>,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>    x0<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    y0<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    x1<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    y1<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="dv">2</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>fig.add_shape(</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">type</span><span class="op">=</span><span class="st">'line'</span>,</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    x0<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    y0<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>    x1<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    y1<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>    line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="dv">2</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>fig.update_layout(template<span class="op">=</span>template, legend_title_text<span class="op">=</span><span class="st">'Constructors:'</span>)</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>In the case of Qatar, we can see how this graph helps us clearly visualize the struggle of the Ducati teams in having a consistent pace (with the exception of the winner, Bastianini). The Suzuki team had a good overall performance, both in terms of speed and consistency.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> performanceITA[performanceITA[<span class="st">'position'</span>] <span class="op">!=</span> <span class="dv">22</span>]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter(</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    df, </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'pace_consistency_index'</span>, </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'pace_speed_index'</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'constructor'</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    color_discrete_sequence<span class="op">=</span>[<span class="st">'red'</span>, <span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'darkorange'</span>, <span class="st">'orange'</span>, <span class="st">'aqua'</span>],</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span>df[<span class="st">'points'</span>].astype(<span class="bu">str</span>).<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">''</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">'0'</span> <span class="cf">else</span> x),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">'pace_speed_index'</span>: <span class="st">'Relative Speed Indicator (in seconds)'</span>, <span class="st">'pace_consistency_index'</span>: <span class="st">'Relative Consistency Indicator (in seconds)'</span>},</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"&lt;b&gt;üáÆüáπ Mugello 2022&lt;/b&gt;&lt;br&gt;Performance Matrix - Riders"</span>,</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># trendline='ols'</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>fig.update_traces(</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    textposition<span class="op">=</span><span class="st">'top center'</span>,</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">8</span>))</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>fig.update_layout(template<span class="op">=</span><span class="st">"plotly_white"</span>,)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>fig.add_shape(</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">type</span><span class="op">=</span><span class="st">'line'</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    x0<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>    y0<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    x1<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    y1<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="dv">2</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>fig.add_shape(</span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">type</span><span class="op">=</span><span class="st">'line'</span>,</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    x0<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    y0<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>    x1<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    y1<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="dv">2</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>fig.update_layout(template<span class="op">=</span>template, legend_title_text<span class="op">=</span><span class="st">'Constructors:'</span>)</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>At Mugello, it‚Äôs interesting to note how the riders who scored points are all grouped in the upper-right quadrant, which means their values for speed and consistency were above average (confirming the demonstrated relationship between the two variables). Only Quartararo (who finished second) demonstrated both consistency and speed among the Yamaha riders, while the other three Yamahas suffered from a noticeable lack of speed that prevented them from scoring points. The Ducati team had a good overall performance, with most of their riders largely confirming their high performance usually demonstrated at their home circuit.</p>
</section>
<section id="a-performance-based-ranking" class="level2">
<h2 class="anchored" data-anchor-id="a-performance-based-ranking">A performance-based ranking</h2>
<p>The two variables that quantify the ‚Äúpace‚Äù can be combined to create an index that summarizes a rider‚Äôs performance in a single value. We will call this the ‚Äúperformance indicator‚Äù, which is an aggregation of the speed and consistency indicators of the pace.</p>
<p>The following table shows the results of the Qatar race along with these indicators. Specifically, from left to right, it includes the starting position, finishing position, difference in positions at the finish, points earned, speed indicator, consistency indicator, and the aggregated performance indicator. This results table, ordered by the latter variable, presents a ‚Äúrevisited‚Äù ranking based on the performance demonstrated by the riders regardless of the final result and events of the race.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>perfQAT <span class="op">=</span> performanceQAT.drop(columns<span class="op">=</span>[</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'avg_speed'</span>, <span class="st">'avg_laptime'</span>, <span class="st">'delta_avg_laptime'</span>,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'delta_std_laptime'</span>]).sort_values(<span class="st">'performance_index'</span>, ascending<span class="op">=</span><span class="va">False</span>).reset_index()</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>perfQAT.index <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>perfQAT.drop(columns<span class="op">=</span><span class="st">'constructor'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">rider</th>
<th data-quarto-table-cell-role="th">grid</th>
<th data-quarto-table-cell-role="th">position</th>
<th data-quarto-table-cell-role="th">pos_delta</th>
<th data-quarto-table-cell-role="th">points</th>
<th data-quarto-table-cell-role="th">pace_speed_index</th>
<th data-quarto-table-cell-role="th">pace_consistency_index</th>
<th data-quarto-table-cell-role="th">performance_index</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Brad Binder</td>
<td>7</td>
<td>2.0</td>
<td>5.0</td>
<td>20</td>
<td>0.87</td>
<td>0.51</td>
<td>0.69</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>Pol Espargaro</td>
<td>6</td>
<td>3.0</td>
<td>3.0</td>
<td>16</td>
<td>0.83</td>
<td>0.52</td>
<td>0.67</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>Enea Bastianini</td>
<td>2</td>
<td>1.0</td>
<td>1.0</td>
<td>25</td>
<td>0.89</td>
<td>0.39</td>
<td>0.64</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>Marc Marquez</td>
<td>3</td>
<td>5.0</td>
<td>-2.0</td>
<td>11</td>
<td>0.70</td>
<td>0.59</td>
<td>0.64</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>Aleix Espargaro</td>
<td>5</td>
<td>4.0</td>
<td>1.0</td>
<td>13</td>
<td>0.79</td>
<td>0.39</td>
<td>0.59</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>Joan Mir</td>
<td>8</td>
<td>6.0</td>
<td>2.0</td>
<td>10</td>
<td>0.67</td>
<td>0.51</td>
<td>0.59</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>Fabio Quartararo</td>
<td>11</td>
<td>9.0</td>
<td>2.0</td>
<td>7</td>
<td>0.41</td>
<td>0.38</td>
<td>0.40</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">8</td>
<td>Alex Rins</td>
<td>10</td>
<td>7.0</td>
<td>3.0</td>
<td>9</td>
<td>0.49</td>
<td>0.27</td>
<td>0.38</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>Takaaki Nakagami</td>
<td>6</td>
<td>10.0</td>
<td>-4.0</td>
<td>6</td>
<td>0.21</td>
<td>0.25</td>
<td>0.23</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>Johann Zarco</td>
<td>3</td>
<td>8.0</td>
<td>-5.0</td>
<td>8</td>
<td>0.41</td>
<td>-0.06</td>
<td>0.17</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>Franco Morbidelli</td>
<td>12</td>
<td>11.0</td>
<td>1.0</td>
<td>5</td>
<td>0.13</td>
<td>0.08</td>
<td>0.10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>Francesco Bagnaia</td>
<td>9</td>
<td>NaN</td>
<td>-9.0</td>
<td>0</td>
<td>0.12</td>
<td>-0.09</td>
<td>0.01</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>Jorge Martin</td>
<td>1</td>
<td>NaN</td>
<td>-17.0</td>
<td>0</td>
<td>0.12</td>
<td>-0.28</td>
<td>-0.08</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>Maverick Vi√±ales</td>
<td>9</td>
<td>12.0</td>
<td>-3.0</td>
<td>4</td>
<td>-0.17</td>
<td>-0.04</td>
<td>-0.10</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">15</td>
<td>Miguel Oliveira</td>
<td>4</td>
<td>NaN</td>
<td>-14.0</td>
<td>0</td>
<td>0.02</td>
<td>-0.23</td>
<td>-0.11</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>Andrea Dovizioso</td>
<td>10</td>
<td>14.0</td>
<td>-4.0</td>
<td>2</td>
<td>-0.36</td>
<td>0.11</td>
<td>-0.12</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>Luca Marini</td>
<td>7</td>
<td>13.0</td>
<td>-6.0</td>
<td>3</td>
<td>-0.35</td>
<td>0.11</td>
<td>-0.12</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>Alex Marquez</td>
<td>8</td>
<td>NaN</td>
<td>-10.0</td>
<td>0</td>
<td>-0.07</td>
<td>-0.22</td>
<td>-0.14</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>Marco Bezzecchi</td>
<td>5</td>
<td>NaN</td>
<td>-13.0</td>
<td>0</td>
<td>-0.27</td>
<td>-0.22</td>
<td>-0.25</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">20</td>
<td>Jack Miller</td>
<td>4</td>
<td>NaN</td>
<td>-14.0</td>
<td>0</td>
<td>-0.23</td>
<td>-0.35</td>
<td>-0.29</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21</td>
<td>Darryn Binder</td>
<td>14</td>
<td>16.0</td>
<td>-2.0</td>
<td>0</td>
<td>-0.98</td>
<td>0.07</td>
<td>-0.45</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">22</td>
<td>Remy Gardner</td>
<td>12</td>
<td>15.0</td>
<td>-3.0</td>
<td>1</td>
<td>-0.98</td>
<td>-0.03</td>
<td>-0.50</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">23</td>
<td>Fabio Di Giannantonio</td>
<td>11</td>
<td>17.0</td>
<td>-6.0</td>
<td>0</td>
<td>-0.99</td>
<td>-0.06</td>
<td>-0.53</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">24</td>
<td>Raul Fernandez</td>
<td>13</td>
<td>18.0</td>
<td>-5.0</td>
<td>0</td>
<td>-1.04</td>
<td>-0.05</td>
<td>-0.55</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In this ‚Äúnew‚Äù ranking (sorted by the aggregated performance indicator), it is interesting to note that the winner (Enea Bastianini), who dominated the race from the first position since the beginning, is relegated to the third position behind Brad Binder and Pol Espargaro. This is due to the fact that these two riders have shown to have a greater speed and consistency than Enea, who, apart from the victory, has equalled the performance of Marc Marquez.</p>
<p>The same concept is applied to the race performances of the constructors in the following table.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>perfQAT_constr <span class="op">=</span> perfQAT.groupby(<span class="st">'constructor'</span>)[[<span class="st">'pace_speed_index'</span>, <span class="st">'pace_consistency_index'</span>, <span class="st">'performance_index'</span>]].mean().sort_values(<span class="st">'performance_index'</span>, ascending<span class="op">=</span><span class="va">False</span>).<span class="bu">round</span>(<span class="dv">2</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># perfQAT_constr = perfQAT_constr.sort_values('performance_index', ascending=False).reset_index()</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># perfQAT_constr.index += 1</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>perfQAT_constr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pace_speed_index</th>
<th data-quarto-table-cell-role="th">pace_consistency_index</th>
<th data-quarto-table-cell-role="th">performance_index</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">constructor</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Suzuki</td>
<td>0.58</td>
<td>0.39</td>
<td>0.48</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Honda</td>
<td>0.42</td>
<td>0.28</td>
<td>0.35</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Aprilia</td>
<td>0.31</td>
<td>0.18</td>
<td>0.24</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Yamaha</td>
<td>-0.20</td>
<td>0.16</td>
<td>-0.02</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Ducati</td>
<td>-0.04</td>
<td>-0.07</td>
<td>-0.06</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">KTM</td>
<td>-0.28</td>
<td>0.05</td>
<td>-0.12</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.scatter(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    perfQAT_constr, </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'pace_consistency_index'</span>, </span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'pace_speed_index'</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span>perfQAT_constr.index,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    color_discrete_sequence<span class="op">=</span>[<span class="st">'aqua'</span>, <span class="st">'orange'</span>, <span class="st">'green'</span>, <span class="st">'blue'</span>, <span class="st">'red'</span>, <span class="st">'darkorange'</span>],</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># text=performanceQAT['points'].astype(str).apply(lambda x: '' if x == '0' else x),</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    text<span class="op">=</span>perfQAT_constr.index,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>{<span class="st">'pace_speed_index'</span>: <span class="st">'Relative Speed Indicator (in seconds)'</span>, <span class="st">'pace_consistency_index'</span>: <span class="st">'Relative Consistency Indicator (in seconds)'</span>},</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">"&lt;b&gt;üá∂üá¶ Qatar 2022&lt;/b&gt;&lt;br&gt;Performance Matrix - Constructors"</span>,</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># trendline='ols'</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>fig.update_traces(</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    textposition<span class="op">=</span><span class="st">'top center'</span>,</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    marker<span class="op">=</span><span class="bu">dict</span>(size<span class="op">=</span><span class="dv">8</span>))</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>fig.add_shape(</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">type</span><span class="op">=</span><span class="st">'line'</span>,</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    x0<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    y0<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    x1<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    y1<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="dv">2</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>fig.add_shape(</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    <span class="bu">type</span><span class="op">=</span><span class="st">'line'</span>,</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    x0<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    y0<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>    x1<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>    y1<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    line<span class="op">=</span><span class="bu">dict</span>(</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span><span class="dv">2</span></span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>fig.update_layout(template<span class="op">=</span>template, showlegend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p>As we can see, thanks in part to the performance matrix applied to the constructors, Suzuki was the most ‚Äúperformant‚Äù motorcycle in Qatar 2022, along with Honda and Aprilia. Ducati, Yamaha, and KTM had subpar performances.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>For the purpose of providing more technical and structured motorsports information to fans, we have demonstrated in this article how public data can be used to extract important information on race and rider performance. While the race results remain undoubtedly the reference for assigning race points, it is still crucial to be able to objectively measure and evaluate the ‚Äúpace‚Äù of the riders, regardless of the checkered flag and race events. By examining two MotoGP races in the 2022 season, we first established the <strong>importance of visually analyzing the race progression</strong> in terms of lap times in order to:</p>
<ul>
<li>Examine the overall <strong>evolution of tire performance and degradation</strong>;</li>
<li><strong>Compare</strong> the <strong>lap time</strong> evolution of riders, teams, and constructors (also in relation to the average).</li>
</ul>
<p>We then demonstrated how lap data can be used to analyze the adaptation of riders, teams, and constructors to different track segments, with the help of aggregate metrics for intermediate sector times.</p>
<p>Finally, we demonstrated the usefulness of <strong>quantifying the performances</strong> of riders, teams, and constructors through <strong>quantitative indicators</strong> that take into account <strong>relative speed and consistency</strong>, the two fundamental variables in the theoretical definition of ‚Äúperformance.‚Äù</p>
<p>In conclusion, the research findings confirm the validity of the initial hypothesis and provide a satisfying answer to the questions that were posed at the beginning of the investigation. It is also believed that this study constitutes an important starting point for the creation of an engaging technical information format for motor racing. The ultimate goal is to promote a constructive and informed debate among industry experts and enthusiasts, providing objective information that allows for statistical evaluation of the performances of riders and vehicles. In this way, we could contribute to fostering a more aware and informed motor racing culture, capable of fully appreciating the technical complexity of this type of sport, especially for those more demanding fans.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>